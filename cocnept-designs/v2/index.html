<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Suspension</title>
        <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
        <!--<script src="../sean/injection.js" charset="utf-8" type="module"></script>-->
        <link href="styles.css" rel="stylesheet">
    </head>

    <body>
        <div class="screen" id="s-smallscreen">
            <p>Bruh. Your screen is too small.<br>Responsive Design coming sometime</p>
        </div>
        
        <div id="container">
            <div class="screen" id="s-menu"></div>
            <div id="menu">
                <div class="menurow">
                    <button>Save</button>
                    <button>Leaderboard</button>
                </div>
                <p class="menutitle">Sounds</p>
                <div class="menutable">
                    <div class="mtlabel">
                        <label for="effects">Effects</label>
                        <label for="music">Music</label>
                    </div>
                    <div class="mtinput">
                        <input type="range" id="effects">
                        <input type="range" id="music">
                    </div>
                </div>
                <div class="menurow">
                    <button onclick="cambiar('unmenu')">Exit Options</button>
                    <button>Exit Game</button>
                </div>
                <div class="menurow">
                    <button>Report a Bug</button>
                </div>
            </div>
            
            <div id="controls">
                <p>Mon 05/12/20</p>
                <p>10:00 AM</p>
                <p>$500</p>
                <div class="stretch"></div>
                <button onclick="cambiar('game')">Computer</button>
                <button onclick="cambiar('office')">Office</button>
                <button onclick="cambiar('menu')">Menu</button>
            </div>
            <div id="game">
                
                <div id="campanel">
                    <div id="camchoose">
                        <div id="map">
                            <div class="maprow">
                                <div class="mapbox">
                                    <button>CamA2</button>
                                </div>
                                <div class="mapbox">
                                    <button>CamB2</button>
                                </div>
                                <div class="mapbox">
                                    <button>CamC2</button>
                                </div>
                            </div>
                            <div class="maprow mbuild">
                                <div class="mapbox"></div>
                                <div class="mapbox"></div>
                                <div class="mapbox"></div>
                            </div>
                            <div class="maprow mbot">
                                <div class="mapbox">
                                    <button>CamA1</button>
                                </div>
                                <div class="mapbox">
                                    <button>CamB1</button>
                                </div>
                                <div class="mapbox">
                                    <button>CamC1</button>
                                </div>
                            </div>
                            <div class="maprow">
                                <div class="mapbox">
                                    <button>CamF1</button>
                                </div>
                                <div class="mapbox">
                                    <button>CamE1</button>
                                </div>
                                <div class="mapbox">
                                    <button>CamD1</button>
                                </div>
                            </div>
                            <div class="maprow mbuild">
                                <div class="mapbox"></div>
                                <div class="mapbox"></div>
                                <div class="mapbox"></div>
                            </div>
                            <div class="maprow mbot">
                                <div class="mapbox">
                                    <button>CamF2</button>
                                </div>
                                <div class="mapbox">
                                    <button>CamE2</button>
                                </div>
                                <div class="mapbox">
                                    <button>CamD2</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="camdetect">
                        <div class="student">
                            <div class="spic"></div>
                            <p class="sname">Munkler,<br>Leuf</p>
                        </div>
                        <div class="student">
                            <div class="spic"></div>
                            <p class="sname">Munkler,<br>Leuf</p>
                        </div>
                        <div class="student">
                            <div class="spic"></div>
                            <p class="sname">Munkler,<br>Leuf</p>
                        </div>
                        <div class="student">
                            <div class="spic"></div>
                            <p class="sname">Munkler,<br>Leuf</p>
                        </div>
                        <div class="student">
                            <div class="spic"></div>
                            <p class="sname">Munkler,<br>Leuf</p>
                        </div>
                        <div class="student">
                            <div class="spic"></div>
                            <p class="sname">Munkler,<br>Leuf</p>
                        </div>
                    </div>
                    <div id="camvis">just imagine this nice gray is security footage :)</div>
                </div>
                
                <div id="infopanel">
                    <div id="directory">
                        <input id="search" type="text" placeholder="Search" oninput="search(this.value)" autocomplete="off" spellcheck="false">
                        <div id="listwrap">
                            <div id="list"></div>
                        </div>
                    </div>
                    <div id="schedule">
                        <div id="table">
                            <div class="tablerow">
                                <p>&mdash;</p>
                                <p>Class Name</p>
                                <p>Rm</p>
                            </div>
                            <div class="tablerow" id="tlist0"></div>
                            <div class="tablerow" id="tlist1"></div>
                            <div class="tablerow" id="tlist2"></div>
                            <div class="tablerow" id="tlist3"></div>
                            <div class="tablerow" id="tlist4"></div>
                            <div class="tablerow" id="tlist5"></div>
                            <button>Summon</button>
                        </div>
                    </div>
                </div>
                
            </div>
            
            <div id="office">
                
                <div id="envpanel">
                    <div id="envvis">insert drag and drop backpack desk here</div>
                </div>
                
                <div id="studentpanel">
                    <div id="studentview">insert face here</div>
                    <div id="dialogue">
                        <p class="sname">Ovinus Real</p>
                        <div id="transwrap">
                            <div id="transcript">
                                <p><span class="tjoin">Ovinus entered the office</span></p>
                                <p><span class="tname">Ovinus: </span>When I was young. When I was young. When I was young. When I was young.</p>
                                <p><span class="tname">Tech Guy: </span>I love gamepro5.</p>
                                <p><span class="tname">Ovinus: </span>If you <span class="trel">release</span> me, I'll tell you who gives us all the drugs.</p>
                                <p><span class="tname">Tech Guy: </span>I love gamepro5.</p>
                                <p><span class="tname">Ovinus: </span>When I was young.</p>
                                <p><span class="tname">Tech Guy: </span>I love gamepro5.</p>
                                <p><span class="tname">Ovinus: </span>When I was young.</p>
                                <p><span class="tname">Tech Guy: </span>I love gamepro5.</p>
                                <p><span class="tname">Ovinus: </span>When I was young.</p>
                                <p><span class="tname">Tech Guy: </span>I love gamepro5.</p>
                                <p><span class="tname">Ovinus: </span>When I was young.</p>
                                <p><span class="tname">Tech Guy: </span>I love gamepro5.</p>
                                <p><span class="tname">Ovinus: </span>When I was young.</p>
                                <p><span class="tname">Tech Guy: </span>I love gamepro5.</p>
                                <p><span class="tname">Ovinus: </span>When I was young.</p>
                                <p><span class="tname">Tech Guy: </span>I love gamepro5.</p>
                                <p><span class="tname">Ovinus: </span>When I was young.</p>
                                <p><span class="tname">Tech Guy: </span>I love gamepro5.</p>
                                <p><span class="tname">Ovinus: </span>When I was young.</p>
                                <p><span class="tname">Tech Guy: </span>I love gamepro5.</p>
                                <p><span class="tname">Ovinus: </span>When I was young.</p>
                                <p><span class="tname">Tech Guy: </span>I love gamepro5.</p>
                                <p><span class="tname">Ovinus: </span>When I was young.</p>
                                <p><span class="tname">Tech Guy: </span>I love gamepro5.</p>
                                <p><span class="tname">Ovinus: </span>When I was young.</p>
                                <p><span class="tname">Tech Guy: </span>I love gamepro5.</p>
                                <p><span class="tname">Ovinus: </span>When I was young.</p>
                                <p><span class="tname">Tech Guy: </span>I love gamepro5.</p>
                            </div>
                        </div>
                        <div id="studentoptions">
                            <div id="talk">
                                <button>Interrogate</button>
                                <button>Bargain</button>
                                <button id="release">Release</button>
                            </div>
                            <div id="sustitle">
                                <p>Suspend</p>
                            </div>
                            <div id="suspend">
                                <button>Drugs</button>
                                <button>Disobediance</button>
                                <button>Bullying</button>
                            </div>
                        </div>
                    </div>
                </div>
                
            </div>
        </div>
        <script type="module">
            function rescale() {
                if (window.innerWidth < 550 || window.innerHeight < 300) {
                    document.getElementById('s-smallscreen').style.opacity = 1;
                    document.getElementById('s-smallscreen').style.visibility = "visible";
                } else {
                    document.getElementById('s-smallscreen').style.opacity = 0;
                    document.getElementById('s-smallscreen').style.visibility = "hidden";
                }
                let container = document.getElementById('container');
                let maxWidth = Math.min(window.innerWidth - 10, 1270);
                let maxHeight = Math.min(window.innerHeight - 10, 710);
                container.style.width = ((1270 + maxWidth * 710 / maxHeight) / 2) + 'px';
                container.style.height = ((710 + maxHeight * 1270 / maxWidth) / 2) + 'px';
                container.style.transform = 'translate(-50%, -50%) scale(' + (2 / (710 / maxHeight + 1270 / maxWidth)) + ')';
            } rescale();
            window.onresize = function () {rescale();}
        </script>
        <script>
            function cambiar(id) {
                if (id === 'unmenu') {
                    document.getElementById('menu').style.display = 'none';
                    document.getElementById('s-menu').style.display = 'none';
                    return;
                }
                document.getElementById(id).style.display = 'flex';
                if (id === 'menu') {
                    document.getElementById('s-menu').style.display = 'flex';
                } else {
                    document.getElementById(id === 'game' ? 'office' : 'game').style.display = 'none';
                }
            }
            
            cambiar('game');
            cambiar('unmenu');
        </script>
        <script type="module">
            import * as SCHOOL from '../../school/school.js';
            import * as SCHEDULE from '../../school/schedule.js';
            import * as SPRITES from '../../characters/sprites/sprite.js';
            
            let school;
            async function dewit() {
                await SPRITES.loadImages();
                school = await SCHOOL.generateSchool();
                SCHEDULE.generateSchedule(school);

                for (let i = 0; i < school.Students.length; i++) {
                    addStudent(school.Students[i]);
                }
            } dewit();
            
            function search(name) {
                for (let i = 0; i < school.Students.length; i++) {
                    let student = school.Students[i];
                    
                    let match = `${student.name.last}, ${student.name.first}`.toLowerCase().includes(name.toLowerCase());
                    document.getElementById(student.id).style.display = match ? 'flex' : 'none';
                }
            }
            
            function getSchedule(student) {
                let schedule = student.schedule;
                
                for (let i = 0; i < 6; i++) {
                    let row = document.getElementById('tlist' + i);
                    row.innerHTML = `<p>${'ABCDEF'[i]}</p><p>${schedule[i].name || ''}</p><p>${(schedule[i].room + 1) || ''}</p>`;
                }
            } getSchedule({schedule: [{}, {}, {}, {}, {}, {}]});
            
            function addStudent(student) {
                let wrapper = document.createElement('div');
                wrapper.classList.add('student');
                wrapper.id = student.id;
                wrapper.addEventListener('click', function() {
                    getSchedule(student);
                });
                document.getElementById('list').appendChild(wrapper);
                
                let picwrap = document.createElement('div');
                picwrap.classList.add('spic');
                wrapper.appendChild(picwrap);
                
                let pic = document.createElement('canvas');
                pic.style.width = '50px';
                pic.style.height = '50px';
                pic.width = 50 * window.devicePixelRatio;
                pic.height = 50 * window.devicePixelRatio;
                let ctx = pic.getContext('2d');
                ctx.imageSmoothingEnabled = false;
                ctx.scale(window.devicePixelRatio, window.devicePixelRatio);
                ctx.drawImage(SPRITES.getSprite(student.picture, true), 0, 0, 50, 50);
                picwrap.appendChild(pic);
                
                let infowrap = document.createElement('div');
                infowrap.classList.add('sinfo');
                wrapper.appendChild(infowrap);
                
                let name = document.createElement('p');
                name.classList.add('sname');
                name.innerHTML = `${student.name.last}, ${student.name.first}`;
                infowrap.appendChild(name);
                
                let info = document.createElement('p');
                let disgrade = student.grade === 9 ? '09' : student.grade;
                info.innerHTML = `Grade ${disgrade} | ${student.gender} | <span class="sstatus">Enrolled</span>`;
                infowrap.appendChild(info);
            }
            
            window.search = search; //better way to do this?
        </script>
    </body>
</html>
