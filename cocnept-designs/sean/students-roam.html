<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>students roam</title>
        <meta name="description" content="password to game is sixty five"/>
        <meta name="viewport" content="width=device-width, initial-scale=1"/>
        <link rel="stylesheet" href="./canvas-stuff.css">
        <style media="screen">
            #wrapper {
                flex: auto;
            }
        </style>
    </head>
    <body>
        <div id="wrapper"></div>
        <script type="module">
            import {WrappedCanvas} from './canvas-stuff.js';
            import {Panner} from './panner.js';

            import {loadImages, getSprite} from '../../characters/sprites/sprite.js';
            import {randomSprite} from '../../characters/sprites/random-sprite.js';

            import {frame} from '../../utils.js';

            let wrappedCanvas = new WrappedCanvas(document.getElementById('wrapper'));
            window.addEventListener('resize', e => {
                wrappedCanvas.resize();
            });

            let panner = new Panner({
                canvas: wrappedCanvas,
                width: 100,
                height: 50
            });
            let c = wrappedCanvas.context;

            async function main() {
                await Promise.all([
                    wrappedCanvas.resize(),
                    loadImages()
                ]);

                let student = getSprite(randomSprite());

                let lastTime = Date.now();
                while (true) {
                    let now = Date.now();
                    let elapsedTime = now - lastTime;
                    if (elapsedTime < 500) {
                        panner.time += elapsedTime;
                    }
                    lastTime = now;

                    let {offsetX, offsetY, scale} = panner.getTransform();
                    c.save();
                    c.translate(offsetX, offsetY);
                    c.scale(scale, scale);

                    c.drawImage(student, 10, 10);

                    c.restore();
                }
            }

            main();
        </script>
    </body>
</html>
